#!/usr/bin/env sh

RUN_GHC=@WithGhc@
if [[ $(printf "9.8.1\n%s\n" $($RUN_GHC --numeric-version) | sort -uV | head -n 1) != "9.8.1" ]]; then echo "Multi-repl needs at least GHC-9.8.1"; exit 1; fi

# This file is generated by configure from ghci-multi.in

set -e
export TOOL_OUTPUT=.hadrian_ghci_multi/ghci_args
# Replace newlines with spaces, as these otherwise break the ghci invocation on windows.
CABFLAGS=-v0 "hadrian/build-cabal" multi --build-root=.hadrian_ghci_multi --flavour=ghc-in-ghci $HADRIAN_ARGS
GHC_FLAGS="$GHC_FLAGS $(cat $TOOL_OUTPUT | tr '\n\r' ' ')"
$RUN_GHC --interactive $GHC_FLAGS $@ -ddump-if-trace -fno-code -fwrite-interface -O0 +RTS -A128m
